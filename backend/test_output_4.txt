  console.log
    DEBUG: ensure createJournalEntry called. autoPost: false

      at createJournalEntry (src/services/accounting.service.ts:68:13)

  console.log
    DEBUG: ensure createJournalEntry called. autoPost: true

      at createJournalEntry (src/services/accounting.service.ts:68:13)

  console.log
    DEBUG: ensure createJournalEntry called. autoPost: true

      at createJournalEntry (src/services/accounting.service.ts:68:13)

  console.log
    DEBUG: ensure createJournalEntry called. autoPost: true

      at createJournalEntry (src/services/accounting.service.ts:68:13)

FAIL tests/unit/services/accounting.service.test.ts
  AccountingService
    createJournalEntry
      ✓ should throw error if debits do not equal credits (71 ms)
      ✕ should create journal entry successfully when balanced (4 ms)
      ✕ should update asset balance correctly (Debit increases) (4 ms)
      ✕ should update liability balance correctly (Credit increases) (2 ms)

  ● AccountingService › createJournalEntry › should create journal entry successfully when balanced

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      66 |             await createJournalEntry(companyId, date, description, reference, lines, true);
      67 |
    > 68 |             expect(prisma.journalEntry.create).toHaveBeenCalled();
         |                                                ^
      69 |             // Should update balances for 2 accounts
      70 |             expect(prisma.ledgerAccount.update).toHaveBeenCalledTimes(2);
      71 |         });

      at Object.<anonymous> (tests/unit/services/accounting.service.test.ts:68:48)

  ● AccountingService › createJournalEntry › should update asset balance correctly (Debit increases)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"data": {"balance": {"increment": 100}}, "where": {"id": "acc-asset"}}

    Number of calls: 0

      90 |
      91 |             // Asset: Debit - Credit = 100 - 0 = +100
    > 92 |             expect(prisma.ledgerAccount.update).toHaveBeenCalledWith(expect.objectContaining({
         |                                                 ^
      93 |                 where: { id: 'acc-asset' },
      94 |                 data: { balance: { increment: 100 } }
      95 |             }));

      at Object.<anonymous> (tests/unit/services/accounting.service.test.ts:92:49)

  ● AccountingService › createJournalEntry › should update liability balance correctly (Credit increases)

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"data": {"balance": {"increment": 100}}, "where": {"id": "acc-liability"}}

    Number of calls: 0

      115 |
      116 |             // Liability: Credit - Debit = 100 - 0 = +100
    > 117 |             expect(prisma.ledgerAccount.update).toHaveBeenCalledWith(expect.objectContaining({
          |                                                 ^
      118 |                 where: { id: 'acc-liability' },
      119 |                 data: { balance: { increment: 100 } }
      120 |             }));

      at Object.<anonymous> (tests/unit/services/accounting.service.test.ts:117:49)

Test Suites: 1 failed, 1 total
Tests:       3 failed, 1 passed, 4 total
Snapshots:   0 total
Time:        4.482 s, estimated 5 s
Ran all test suites matching tests/unit/services/accounting.service.test.ts.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
