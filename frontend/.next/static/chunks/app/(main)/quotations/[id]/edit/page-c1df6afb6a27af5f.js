(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7130],{62898:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var s=r(2265),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let r=(0,s.forwardRef)(({color:r="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:d,className:c="",children:o,...u},m)=>(0,s.createElement)("svg",{ref:m,...a,width:i,height:i,stroke:r,strokeWidth:d?24*Number(l)/Number(i):l,className:["lucide",`lucide-${n(e)}`,c].join(" "),...u},[...t.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(o)?o:[o]]));return r.displayName=`${e}`,r}},73067:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(62898).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},28203:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(62898).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},6141:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(62898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},9883:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(62898).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},92295:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(62898).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},41827:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(62898).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},45367:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,r(62898).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},15308:function(e,t,r){Promise.resolve().then(r.bind(r,85469))},85469:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var s=r(57437),a=r(2265),n=r(24033),i=r(61153),l=r(43206),d=r(7319),c=r(18559),o=r(73067),u=r(28203),m=r(6141),x=r(9883),p=r(45367),y=r(92295),h=r(55582),b=r(10826),g=r(37902);function f(e){let t,r,f,{params:j}=e,v=(0,n.useRouter)(),N=(0,i.p)(),{can:w}=(0,l.g)(),{formatCurrency:k,currency:q}=(0,c.U)(),[C,T]=(0,a.useState)(!1),[Z,S]=(0,a.useState)(!0),[P,I]=(0,a.useState)([]),[F,D]=(0,a.useState)({leadId:"",title:"",description:"",validUntil:"",paymentTerms:"",deliveryTerms:"",notes:"",currency:q,reminderFrequency:"",maxReminders:3}),[E,R]=(0,a.useState)([{description:"",quantity:1,unitPrice:0,tax:18,discount:0}]);(0,a.useEffect)(()=>{if(!w("Quotation","update")){N.error("Access denied"),v.push("/quotations");return}(async()=>{try{let[e,t]=await Promise.all([b.Z.get("/leads"),g.R.getById(j.id)]);I(e.data.leads||[]);let r=t.quotation;if(!r){N.error("Quotation not found"),v.push("/quotations");return}if("draft"!==r.status){N.error("Only draft quotations can be edited"),v.push("/quotations/".concat(j.id));return}D({leadId:r.leadId||r.clientId||"",title:r.title,description:r.description||"",validUntil:r.validUntil?new Date(r.validUntil).toISOString().split("T")[0]:"",paymentTerms:r.paymentTerms||"",deliveryTerms:r.deliveryTerms||"",notes:r.notes||"",currency:q,reminderFrequency:r.reminderFrequency||"",maxReminders:r.maxReminders||3}),r.items&&r.items.length>0&&R(r.items.map(e=>({description:e.description,quantity:Number(e.quantity),unitPrice:Number(e.unitPrice),tax:Number(e.tax),discount:Number(e.discount)})))}catch(e){console.error("Failed to load data",e),N.error("Failed to load quotation data")}finally{S(!1)}})()},[j.id,w,v,N,q]);let U=e=>{R(E.filter((t,r)=>r!==e))},A=(e,t,r)=>{let s=[...E];s[e]={...s[e],[t]:r},R(s)},L=async e=>{e.preventDefault();let t=E.filter(e=>""!==e.description.trim()&&e.quantity>0);if(!F.leadId||!F.title){N.error("Please fill all required fields (Client and Title)");return}if(0===t.length){N.error("Please add at least one valid item line");return}try{T(!0),await g.R.update(j.id,{...F,items:t.map(e=>({...e,total:e.quantity*e.unitPrice}))}),N.success("Quotation updated successfully"),v.push("/quotations/".concat(j.id))}catch(t){var r,s;let e=(null===(s=t.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.error)||"Failed to update quotation";N.error(e)}finally{T(!1)}},M=(t=0,r=0,f=0,E.forEach(e=>{let s=e.quantity*e.unitPrice,a=s*e.tax/100,n=s*e.discount/100;t+=s,r+=a,f+=n}),{subtotal:t,tax:r,discount:f,total:t+r-f});return Z?(0,s.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,s.jsx)(d.T,{size:"lg"})}):(0,s.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[(0,s.jsxs)("button",{onClick:()=>v.back(),className:"flex items-center text-gray-600 hover:text-gray-900 mb-6 transition",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),"Back"]}),(0,s.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Quotation"})}),(0,s.jsxs)("form",{onSubmit:L,className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-8 space-y-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client / Lead ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("select",{required:!0,value:F.leadId,onChange:e=>D({...F,leadId:e.target.value}),className:"w-full border border-gray-300 rounded-md px-4 py-2.5 bg-gray-50 focus:bg-white transition focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[(0,s.jsx)("option",{value:"",children:"Select Lead or Client"}),P.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," ",e.company?"- ".concat(e.company):""]},e.id))]})]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Valid Until ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Z,{className:"absolute left-3 top-2.5 text-gray-400 w-4 h-4"}),(0,s.jsx)("input",{type:"date",required:!0,value:F.validUntil,onChange:e=>D({...F,validUntil:e.target.value}),className:"w-full pl-10 border border-gray-300 rounded-md px-4 py-2.5 bg-gray-50 focus:bg-white transition focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),(0,s.jsxs)("div",{className:"w-1/3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),(0,s.jsxs)("select",{value:F.currency,onChange:e=>D({...F,currency:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2.5 bg-white",children:[(0,s.jsx)("option",{value:"INR",children:"INR (â‚¹)"}),(0,s.jsx)("option",{value:"USD",children:"USD ($)"})]})]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pt-4",children:(0,s.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-100",children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold text-orange-800 mb-3 flex items-center",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"Auto-Follow Up (Beta)"]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-orange-700 mb-1",children:"Frequency"}),(0,s.jsxs)("select",{value:F.reminderFrequency,onChange:e=>D({...F,reminderFrequency:e.target.value}),className:"w-full border border-orange-200 rounded-md px-3 py-2 text-sm focus:ring-orange-500 focus:border-orange-500",children:[(0,s.jsx)("option",{value:"",children:"Disabled"}),(0,s.jsx)("option",{value:"DAILY",children:"Daily"}),(0,s.jsx)("option",{value:"3_DAYS",children:"Every 3 Days"}),(0,s.jsx)("option",{value:"WEEKLY",children:"Weekly"})]})]}),F.reminderFrequency&&(0,s.jsxs)("div",{className:"w-1/3",children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-orange-700 mb-1",children:"Max Emails"}),(0,s.jsx)("input",{type:"number",min:"1",max:"10",value:F.maxReminders,onChange:e=>D({...F,maxReminders:parseInt(e.target.value)}),className:"w-full border border-orange-200 rounded-md px-3 py-2 text-sm focus:ring-orange-500 focus:border-orange-500"})]})]}),(0,s.jsx)("p",{className:"text-xs text-orange-600 mt-2",children:F.reminderFrequency?"System will send up to ".concat(F.maxReminders," reminder emails automatically."):"Select a frequency to enable automated follow-up emails."})]})}),(0,s.jsx)("div",{className:"border-t border-gray-100"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Quotation Title ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",required:!0,value:F.title,onChange:e=>D({...F,title:e.target.value}),className:"w-full border border-gray-300 rounded-md px-4 py-2.5 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,s.jsx)("textarea",{value:F.description,onChange:e=>D({...F,description:e.target.value}),className:"w-full border border-gray-300 rounded-md px-4 py-2.5 focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:2})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Line Items"}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(h.Z,{onSelect:e=>{let t=E.findIndex(e=>""===e.description&&0===e.unitPrice);if(-1!==t){let r=[...E];r[t]={description:e.name,quantity:1,unitPrice:e.price,tax:e.tax,discount:0},R(r)}else R([...E,{description:e.name,quantity:1,unitPrice:e.price,tax:e.tax,discount:0}]);N.success("Added ".concat(e.name))}}),(0,s.jsxs)("button",{type:"button",onClick:()=>{R([...E,{description:"",quantity:1,unitPrice:0,tax:18,discount:0}])},className:"px-3 py-1.5 bg-primary-50 text-primary-700 rounded-md text-sm font-medium hover:bg-primary-100 transition flex items-center",children:[(0,s.jsx)(x.Z,{className:"w-4 h-4 mr-1"})," Add Custom Item"]})]})]}),(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-6",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-5/12",children:"Description"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/12",children:"Qty"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-2/12",children:"Price"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/12",children:"Tax %"}),(0,s.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-2/12",children:"Total"}),(0,s.jsx)("th",{className:"px-4 py-3 w-1/12"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:E.map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("input",{type:"text",value:e.description,onChange:e=>A(t,"description",e.target.value),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent"})}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("input",{type:"number",value:e.quantity,onChange:e=>A(t,"quantity",parseFloat(e.target.value)),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent",min:"1"})}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("input",{type:"number",value:e.unitPrice,onChange:e=>A(t,"unitPrice",parseFloat(e.target.value)),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent",min:"0"})}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("input",{type:"number",value:e.tax,onChange:e=>A(t,"tax",parseFloat(e.target.value)),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent text-gray-500"})}),(0,s.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:k(e.quantity*e.unitPrice)}),(0,s.jsx)("td",{className:"px-4 py-3 text-center",children:E.length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>U(t),className:"text-gray-400 hover:text-red-500 transition",children:(0,s.jsx)(p.Z,{className:"w-4 h-4"})})})]},t))})]})}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)("div",{className:"w-full md:w-1/3 bg-gray-50 rounded-lg p-6 space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,s.jsx)("span",{children:"Subtotal:"}),(0,s.jsx)("span",{children:k(M.subtotal)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,s.jsx)("span",{children:"Total Tax:"}),(0,s.jsx)("span",{children:k(M.tax)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,s.jsx)("span",{children:"Total Discount:"}),(0,s.jsxs)("span",{children:["-",k(M.discount)]})]}),(0,s.jsxs)("div",{className:"pt-3 border-t border-gray-200 flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-base font-bold text-gray-900",children:"Grand Total"}),(0,s.jsx)("span",{className:"text-xl font-bold text-primary-700",children:k(M.total)})]})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-8 pt-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),(0,s.jsx)("textarea",{value:F.paymentTerms,onChange:e=>D({...F,paymentTerms:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:3})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Terms"}),(0,s.jsx)("textarea",{value:F.deliveryTerms,onChange:e=>D({...F,deliveryTerms:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:3})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,s.jsx)("textarea",{value:F.notes,onChange:e=>D({...F,notes:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:2})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 px-8 py-5 flex justify-end items-center space-x-4 border-t border-gray-100",children:[(0,s.jsx)("button",{type:"button",onClick:()=>v.back(),className:"px-5 py-2.5 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition",children:"Cancel"}),(0,s.jsxs)("button",{type:"submit",disabled:C,className:"px-5 py-2.5 bg-primary-600 text-white rounded-lg shadow-sm text-sm font-medium hover:bg-primary-700 disabled:opacity-50 flex items-center transition",children:[C&&(0,s.jsx)(d.T,{size:"sm",className:"mr-2"}),(0,s.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),C?"Saving...":"Save Changes"]})]})]})]})}},24033:function(e,t,r){e.exports=r(15313)}},function(e){e.O(0,[4737,5174,2971,4938,1744],function(){return e(e.s=15308)}),_N_E=e.O()}]);