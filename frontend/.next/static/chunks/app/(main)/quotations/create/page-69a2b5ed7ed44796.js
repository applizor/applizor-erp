(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7059],{80952:function(e,t,s){Promise.resolve().then(s.bind(s,61199))},61199:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return C}});var a=s(57437),r=s(2265),l=s(24033),i=s(10826),n=s(61153),d=s(43206),o=s(7319),c=s(18559),m=s(73067),x=s(92295),u=s(28203),p=s(6141),y=s(9883),h=s(45367),b=s(55582),g=s(37902),f=s(69102),j=s.n(f),v=s(24930),N=s.n(v);s(21851);let w=N()(()=>Promise.all([s.e(3070),s.e(6233)]).then(s.t.bind(s,6233,23)),{loadableGenerated:{webpack:()=>[6233]},ssr:!1});function k(e){let{value:t,onChange:s,placeholder:l,className:i}=e,n=(0,r.useRef)(null);return(0,a.jsxs)("div",{className:"jsx-5e1fdf0e8e238c5 "+(i||""),children:[(0,a.jsx)(w,{ref:n,theme:"snow",value:t,onChange:s,modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],["link"],["clean"]]},formats:["header","bold","italic","underline","strike","list","bullet","indent","link"],placeholder:l,className:"bg-white"}),(0,a.jsx)(j(),{id:"5e1fdf0e8e238c5",children:".ql-container{min-height:150px;font-size:14px}.ql-editor{min-height:150px}.ql-editor.ql-blank::before{font-style:normal;color:#9ca3af}"})]})}function C(){let e,t,s;let f=(0,l.useRouter)(),j=(0,n.p)(),{can:v,user:N}=(0,d.g)(),{formatCurrency:w,currency:C}=(0,c.U)(),[T,q]=(0,r.useState)(!1),[P,S]=(0,r.useState)([]),[D,F]=(0,r.useState)([]),[E,I]=(0,r.useState)(""),[R,Z]=(0,r.useState)(!1),[U,A]=(0,r.useState)({name:"",category:""});(0,r.useEffect)(()=>{null===N||v("Quotation","create")||(j.error("Access denied"),f.push("/quotations"))},[v,N,f,j]);let[Q,_]=(0,r.useState)({leadId:"",title:"",description:"",validUntil:"",paymentTerms:"Payment due within 30 days. \n50% Advance to start work.",deliveryTerms:"Delivery via Email/Cloud Link.",notes:"This quotation is valid for 15 days.",currency:C,reminderFrequency:"",maxReminders:3}),[L,B]=(0,r.useState)([{description:"",quantity:1,unitPrice:0,tax:18,discount:0}]);(0,r.useEffect)(()=>{W(),G()},[]);let W=async()=>{try{let e=await i.Z.get("/leads");S(e.data.leads||[])}catch(e){console.error("Failed to load leads")}},G=async()=>{try{let e=await i.Z.get("/quotation-templates");F(e.data.templates||[])}catch(e){console.error("Failed to load templates")}},Y=async e=>{if(e)try{let t=(await i.Z.post("/quotation-templates/".concat(e,"/apply"))).data.template;_({...Q,title:t.title,description:t.templateDescription,paymentTerms:t.paymentTerms||Q.paymentTerms,deliveryTerms:t.deliveryTerms||Q.deliveryTerms,notes:t.notes||Q.notes}),t.items&&Array.isArray(t.items)&&B(t.items),j.success("Template applied successfully")}catch(e){j.error("Failed to apply template")}},z=async()=>{if(!Q.title){j.error("Please enter a quotation title first");return}A({name:Q.title,category:""}),Z(!0)},O=async()=>{if(!U.name){j.error("Please enter template name");return}try{await i.Z.post("/quotation-templates",{name:U.name,category:U.category||void 0,title:Q.title,templateDescription:Q.description,paymentTerms:Q.paymentTerms,deliveryTerms:Q.deliveryTerms,notes:Q.notes,items:L}),j.success("Template saved successfully"),Z(!1),A({name:"",category:""}),G()}catch(e){j.error("Failed to save template")}},K=e=>{B(L.filter((t,s)=>s!==e))},M=(e,t,s)=>{let a=[...L];a[e]={...a[e],[t]:s},B(a)},V=async e=>{e.preventDefault();let t=L.filter(e=>""!==e.description.trim()&&e.quantity>0);if(!Q.leadId||!Q.title){j.error("Please fill all required fields (Client and Title)");return}if(0===t.length){j.error("Please add at least one valid item line");return}try{q(!0),await g.R.create({...Q,items:t.map(e=>({...e,total:e.quantity*e.unitPrice}))}),j.success("Quotation created successfully"),f.push("/quotations")}catch(t){var s,a;let e=(null===(a=t.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.error)||"Failed to create quotation";j.error(e)}finally{q(!1)}},$=(e=0,t=0,s=0,L.forEach(a=>{let r=a.quantity*a.unitPrice,l=r*a.tax/100,i=r*a.discount/100;e+=r,t+=l,s+=i}),{subtotal:e,tax:t,discount:s,total:e+t-s});return(0,a.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[(0,a.jsxs)("button",{onClick:()=>f.back(),className:"flex items-center text-gray-600 hover:text-gray-900 mb-6 transition",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"Back to Quotations"]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Create New Quotation"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[D.length>0&&(0,a.jsxs)("select",{value:E,onChange:e=>{I(e.target.value),Y(e.target.value)},className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[(0,a.jsx)("option",{value:"",children:"Use Template..."}),D.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsxs)("button",{type:"button",onClick:z,className:"px-4 py-2 border border-primary-600 text-primary-600 rounded-lg hover:bg-primary-50 flex items-center",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"Save as Template"]})]})]}),(0,a.jsxs)("form",{onSubmit:V,className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-8 space-y-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client / Lead ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{required:!0,value:Q.leadId,onChange:e=>_({...Q,leadId:e.target.value}),className:"w-full border border-gray-300 rounded-md px-4 py-2.5 bg-gray-50 focus:bg-white transition focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[(0,a.jsx)("option",{value:"",children:"Select Lead or Client"}),P.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," ",e.company?"- ".concat(e.company):""]},e.id))]})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Valid Until ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(u.Z,{className:"absolute left-3 top-2.5 text-gray-400 w-4 h-4"}),(0,a.jsx)("input",{type:"date",required:!0,value:Q.validUntil,onChange:e=>_({...Q,validUntil:e.target.value}),className:"w-full pl-10 border border-gray-300 rounded-md px-4 py-2.5 bg-gray-50 focus:bg-white transition focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),(0,a.jsxs)("div",{className:"w-1/3",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),(0,a.jsxs)("select",{value:Q.currency,onChange:e=>_({...Q,currency:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2.5 bg-white",children:[(0,a.jsx)("option",{value:"INR",children:"INR (₹)"}),(0,a.jsx)("option",{value:"USD",children:"USD ($)"}),(0,a.jsx)("option",{value:"EUR",children:"EUR (€)"}),(0,a.jsx)("option",{value:"GBP",children:"GBP (\xa3)"})]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pt-4",children:(0,a.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-100",children:[(0,a.jsxs)("h4",{className:"text-sm font-semibold text-orange-800 mb-3 flex items-center",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),"Auto-Follow Up (Beta)"]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-orange-700 mb-1",children:"Frequency"}),(0,a.jsxs)("select",{value:Q.reminderFrequency,onChange:e=>_({...Q,reminderFrequency:e.target.value}),className:"w-full border border-orange-200 rounded-md px-3 py-2 text-sm focus:ring-orange-500 focus:border-orange-500",children:[(0,a.jsx)("option",{value:"",children:"Disabled"}),(0,a.jsx)("option",{value:"DAILY",children:"Daily"}),(0,a.jsx)("option",{value:"3_DAYS",children:"Every 3 Days"}),(0,a.jsx)("option",{value:"WEEKLY",children:"Weekly"})]})]}),Q.reminderFrequency&&(0,a.jsxs)("div",{className:"w-1/3",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-orange-700 mb-1",children:"Max Emails"}),(0,a.jsx)("input",{type:"number",min:"1",max:"10",value:Q.maxReminders,onChange:e=>_({...Q,maxReminders:parseInt(e.target.value)}),className:"w-full border border-orange-200 rounded-md px-3 py-2 text-sm focus:ring-orange-500 focus:border-orange-500"})]})]}),(0,a.jsx)("p",{className:"text-xs text-orange-600 mt-2",children:Q.reminderFrequency?"System will send up to ".concat(Q.maxReminders," reminder emails automatically."):"Select a frequency to enable automated follow-up emails."})]})})]}),(0,a.jsx)("div",{className:"border-t border-gray-100"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Quotation Title ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",required:!0,value:Q.title,onChange:e=>_({...Q,title:e.target.value}),className:"w-full border border-gray-300 rounded-md px-4 py-2.5 focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"e.g., Website Redesign Project"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,a.jsx)(k,{value:Q.description,onChange:e=>_({...Q,description:e}),placeholder:"Brief summary of the scope... You can paste from Word documents with formatting."})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Line Items"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(b.Z,{onSelect:e=>{let t=L.findIndex(e=>""===e.description&&0===e.unitPrice);if(-1!==t){let s=[...L];s[t]={description:e.name,quantity:1,unitPrice:e.price,tax:e.tax,discount:0},B(s)}else B([...L,{description:e.name,quantity:1,unitPrice:e.price,tax:e.tax,discount:0}]);j.success("Added ".concat(e.name))}}),(0,a.jsxs)("button",{type:"button",onClick:()=>{B([...L,{description:"",quantity:1,unitPrice:0,tax:18,discount:0}])},className:"px-3 py-1.5 bg-primary-50 text-primary-700 rounded-md text-sm font-medium hover:bg-primary-100 transition flex items-center",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-1"})," Add Custom Item"]})]})]}),(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-6",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-5/12",children:"Description"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/12",children:"Qty"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-2/12",children:"Price"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/12",children:"Tax %"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-2/12",children:"Total"}),(0,a.jsx)("th",{className:"px-4 py-3 w-1/12"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:L.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("input",{type:"text",value:e.description,onChange:e=>M(t,"description",e.target.value),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent",placeholder:"Item name or description"})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("input",{type:"number",value:e.quantity,onChange:e=>M(t,"quantity",parseFloat(e.target.value)),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent",min:"1"})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("input",{type:"number",value:e.unitPrice,onChange:e=>M(t,"unitPrice",parseFloat(e.target.value)),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent",min:"0"})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("input",{type:"number",value:e.tax,onChange:e=>M(t,"tax",parseFloat(e.target.value)),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent text-gray-500"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:w(e.quantity*e.unitPrice)}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:L.length>1&&(0,a.jsx)("button",{type:"button",onClick:()=>K(t),className:"text-gray-400 hover:text-red-500 transition",children:(0,a.jsx)(h.Z,{className:"w-4 h-4"})})})]},t))})]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"w-full md:w-1/3 bg-gray-50 rounded-lg p-6 space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsx)("span",{children:w($.subtotal)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,a.jsx)("span",{children:"Total Tax:"}),(0,a.jsx)("span",{children:w($.tax)})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[(0,a.jsx)("span",{children:"Total Discount:"}),(0,a.jsxs)("span",{children:["-",w($.discount)]})]}),(0,a.jsxs)("div",{className:"pt-3 border-t border-gray-200 flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-base font-bold text-gray-900",children:"Grand Total"}),(0,a.jsx)("span",{className:"text-xl font-bold text-primary-700",children:w($.total)})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-8 pt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),(0,a.jsx)("textarea",{value:Q.paymentTerms,onChange:e=>_({...Q,paymentTerms:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Terms"}),(0,a.jsx)("textarea",{value:Q.deliveryTerms,onChange:e=>_({...Q,deliveryTerms:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:3})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,a.jsx)("textarea",{value:Q.notes,onChange:e=>_({...Q,notes:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:2,placeholder:"Additional private notes..."})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 px-8 py-5 flex justify-end items-center space-x-4 border-t border-gray-100",children:[(0,a.jsx)("button",{type:"button",onClick:()=>f.back(),className:"px-5 py-2.5 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition",children:"Cancel"}),(0,a.jsxs)("button",{type:"submit",disabled:T,className:"px-5 py-2.5 bg-primary-600 text-white rounded-lg shadow-sm text-sm font-medium hover:bg-primary-700 disabled:opacity-50 flex items-center transition",children:[T&&(0,a.jsx)(o.T,{size:"sm",className:"mr-2"}),T?"Creating...":"Create Quotation"]})]})]}),R&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:(0,a.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:()=>Z(!1)}),(0,a.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),(0,a.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[(0,a.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:(0,a.jsxs)("div",{className:"sm:flex sm:items-start",children:[(0,a.jsx)("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-primary-100 sm:mx-0 sm:h-10 sm:w-10",children:(0,a.jsx)(x.Z,{className:"h-6 w-6 text-primary-600"})}),(0,a.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:"Save as Template"}),(0,a.jsxs)("div",{className:"mt-2 space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Save the current quotation configuration as a reusable template."}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Template Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:U.name,onChange:e=>A({...U,name:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-primary-500 focus:border-primary-500 outline-none",placeholder:"e.g. Website Development Standard",autoFocus:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category (Optional)"}),(0,a.jsx)("input",{type:"text",value:U.category,onChange:e=>A({...U,category:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-primary-500 focus:border-primary-500 outline-none",placeholder:"e.g. Development"})]})]})]})]})}),(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[(0,a.jsx)("button",{type:"button",onClick:O,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm",children:"Save Template"}),(0,a.jsx)("button",{type:"button",onClick:()=>Z(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Cancel"})]})]})]})})]})}}},function(e){e.O(0,[4737,4089,5174,2971,4938,1744],function(){return e(e.s=80952)}),_N_E=e.O()}]);