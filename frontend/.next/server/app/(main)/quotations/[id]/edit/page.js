(()=>{var e={};e.id=7130,e.ids=[7130],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},95687:e=>{"use strict";e.exports=require("https")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},44982:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>o});var s=r(50482),a=r(69108),i=r(62563),n=r.n(i),l=r(68300),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);r.d(t,d);let o=["",{children:["(main)",{children:["quotations",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,55729)),"/Users/arun/Documents/applizor-softech-erp/frontend/app/(main)/quotations/[id]/edit/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,22758)),"/Users/arun/Documents/applizor-softech-erp/frontend/app/(main)/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,12962)),"/Users/arun/Documents/applizor-softech-erp/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,69361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/arun/Documents/applizor-softech-erp/frontend/app/(main)/quotations/[id]/edit/page.tsx"],u="/(main)/quotations/[id]/edit/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(main)/quotations/[id]/edit/page",pathname:"/quotations/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},5592:(e,t,r)=>{Promise.resolve().then(r.bind(r,76098))},76098:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var s=r(95344),a=r(3729),i=r(22254),n=r(43989),l=r(65489),d=r(95252),o=r(73050),c=r(63024),u=r(55794),m=r(25545),x=r(51838),p=r(38271),y=r(31498),h=r(15533),g=r(18117),b=r(2285);function f({params:e}){let t,r,f;let j=(0,i.useRouter)(),v=(0,n.p)(),{can:N}=(0,l.g)(),{formatCurrency:q,currency:w}=(0,o.U)(),[P,C]=(0,a.useState)(!1),[T,k]=(0,a.useState)(!0),[S,D]=(0,a.useState)([]),[_,I]=(0,a.useState)({leadId:"",title:"",description:"",validUntil:"",paymentTerms:"",deliveryTerms:"",notes:"",currency:w,reminderFrequency:"",maxReminders:3}),[U,F]=(0,a.useState)([{description:"",quantity:1,unitPrice:0,tax:18,discount:0}]);(0,a.useEffect)(()=>{if(!N("Quotation","update")){v.error("Access denied"),j.push("/quotations");return}(async()=>{try{let[t,r]=await Promise.all([g.Z.get("/leads"),b.R.getById(e.id)]);D(t.data.leads||[]);let s=r.quotation;if(!s){v.error("Quotation not found"),j.push("/quotations");return}if("draft"!==s.status){v.error("Only draft quotations can be edited"),j.push(`/quotations/${e.id}`);return}I({leadId:s.leadId||s.clientId||"",title:s.title,description:s.description||"",validUntil:s.validUntil?new Date(s.validUntil).toISOString().split("T")[0]:"",paymentTerms:s.paymentTerms||"",deliveryTerms:s.deliveryTerms||"",notes:s.notes||"",currency:w,reminderFrequency:s.reminderFrequency||"",maxReminders:s.maxReminders||3}),s.items&&s.items.length>0&&F(s.items.map(e=>({description:e.description,quantity:Number(e.quantity),unitPrice:Number(e.unitPrice),tax:Number(e.tax),discount:Number(e.discount)})))}catch(e){console.error("Failed to load data",e),v.error("Failed to load quotation data")}finally{k(!1)}})()},[e.id,N,j,v,w]);let R=e=>{F(U.filter((t,r)=>r!==e))},E=(e,t,r)=>{let s=[...U];s[e]={...s[e],[t]:r},F(s)},A=async t=>{t.preventDefault();let r=U.filter(e=>""!==e.description.trim()&&e.quantity>0);if(!_.leadId||!_.title){v.error("Please fill all required fields (Client and Title)");return}if(0===r.length){v.error("Please add at least one valid item line");return}try{C(!0),await b.R.update(e.id,{..._,items:r.map(e=>({...e,total:e.quantity*e.unitPrice}))}),v.success("Quotation updated successfully"),j.push(`/quotations/${e.id}`)}catch(t){let e=t.response?.data?.error||"Failed to update quotation";v.error(e)}finally{C(!1)}},z=(t=0,r=0,f=0,U.forEach(e=>{let s=e.quantity*e.unitPrice,a=s*e.tax/100,i=s*e.discount/100;t+=s,r+=a,f+=i}),{subtotal:t,tax:r,discount:f,total:t+r-f});return T?s.jsx("div",{className:"flex items-center justify-center h-screen",children:s.jsx(d.T,{size:"lg"})}):(0,s.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[(0,s.jsxs)("button",{onClick:()=>j.back(),className:"flex items-center text-gray-600 hover:text-gray-900 mb-6 transition",children:[s.jsx(c.Z,{className:"w-4 h-4 mr-2"}),"Back"]}),s.jsx("div",{className:"flex justify-between items-center mb-6",children:s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Quotation"})}),(0,s.jsxs)("form",{onSubmit:A,className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-8 space-y-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client / Lead ",s.jsx("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("select",{required:!0,value:_.leadId,onChange:e=>I({..._,leadId:e.target.value}),className:"w-full border border-gray-300 rounded-md px-4 py-2.5 bg-gray-50 focus:bg-white transition focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[s.jsx("option",{value:"",children:"Select Lead or Client"}),S.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.name," ",e.company?`- ${e.company}`:""]},e.id))]})]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Valid Until ",s.jsx("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx(u.Z,{className:"absolute left-3 top-2.5 text-gray-400 w-4 h-4"}),s.jsx("input",{type:"date",required:!0,value:_.validUntil,onChange:e=>I({..._,validUntil:e.target.value}),className:"w-full pl-10 border border-gray-300 rounded-md px-4 py-2.5 bg-gray-50 focus:bg-white transition focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),(0,s.jsxs)("div",{className:"w-1/3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),(0,s.jsxs)("select",{value:_.currency,onChange:e=>I({..._,currency:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2.5 bg-white",children:[s.jsx("option",{value:"INR",children:"INR (â‚¹)"}),s.jsx("option",{value:"USD",children:"USD ($)"})]})]})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 pt-4",children:(0,s.jsxs)("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-100",children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold text-orange-800 mb-3 flex items-center",children:[s.jsx(m.Z,{className:"w-4 h-4 mr-2"}),"Auto-Follow Up (Beta)"]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-xs font-medium text-orange-700 mb-1",children:"Frequency"}),(0,s.jsxs)("select",{value:_.reminderFrequency,onChange:e=>I({..._,reminderFrequency:e.target.value}),className:"w-full border border-orange-200 rounded-md px-3 py-2 text-sm focus:ring-orange-500 focus:border-orange-500",children:[s.jsx("option",{value:"",children:"Disabled"}),s.jsx("option",{value:"DAILY",children:"Daily"}),s.jsx("option",{value:"3_DAYS",children:"Every 3 Days"}),s.jsx("option",{value:"WEEKLY",children:"Weekly"})]})]}),_.reminderFrequency&&(0,s.jsxs)("div",{className:"w-1/3",children:[s.jsx("label",{className:"block text-xs font-medium text-orange-700 mb-1",children:"Max Emails"}),s.jsx("input",{type:"number",min:"1",max:"10",value:_.maxReminders,onChange:e=>I({..._,maxReminders:parseInt(e.target.value)}),className:"w-full border border-orange-200 rounded-md px-3 py-2 text-sm focus:ring-orange-500 focus:border-orange-500"})]})]}),s.jsx("p",{className:"text-xs text-orange-600 mt-2",children:_.reminderFrequency?`System will send up to ${_.maxReminders} reminder emails automatically.`:"Select a frequency to enable automated follow-up emails."})]})}),s.jsx("div",{className:"border-t border-gray-100"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Quotation Title ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",required:!0,value:_.title,onChange:e=>I({..._,title:e.target.value}),className:"w-full border border-gray-300 rounded-md px-4 py-2.5 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),s.jsx("textarea",{value:_.description,onChange:e=>I({..._,description:e.target.value}),className:"w-full border border-gray-300 rounded-md px-4 py-2.5 focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:2})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Line Items"}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx(h.Z,{onSelect:e=>{let t=U.findIndex(e=>""===e.description&&0===e.unitPrice);if(-1!==t){let r=[...U];r[t]={description:e.name,quantity:1,unitPrice:e.price,tax:e.tax,discount:0},F(r)}else F([...U,{description:e.name,quantity:1,unitPrice:e.price,tax:e.tax,discount:0}]);v.success(`Added ${e.name}`)}}),(0,s.jsxs)("button",{type:"button",onClick:()=>{F([...U,{description:"",quantity:1,unitPrice:0,tax:18,discount:0}])},className:"px-3 py-1.5 bg-primary-50 text-primary-700 rounded-md text-sm font-medium hover:bg-primary-100 transition flex items-center",children:[s.jsx(x.Z,{className:"w-4 h-4 mr-1"})," Add Custom Item"]})]})]}),s.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-6",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-5/12",children:"Description"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/12",children:"Qty"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-2/12",children:"Price"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/12",children:"Tax %"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-2/12",children:"Total"}),s.jsx("th",{className:"px-4 py-3 w-1/12"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:U.map((e,t)=>(0,s.jsxs)("tr",{children:[s.jsx("td",{className:"px-4 py-3",children:s.jsx("input",{type:"text",value:e.description,onChange:e=>E(t,"description",e.target.value),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent"})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("input",{type:"number",value:e.quantity,onChange:e=>E(t,"quantity",parseFloat(e.target.value)),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent",min:"1"})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("input",{type:"number",value:e.unitPrice,onChange:e=>E(t,"unitPrice",parseFloat(e.target.value)),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent",min:"0"})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("input",{type:"number",value:e.tax,onChange:e=>E(t,"tax",parseFloat(e.target.value)),className:"w-full border-0 border-b border-transparent focus:border-primary-500 focus:ring-0 p-0 text-sm bg-transparent text-gray-500"})}),s.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:q(e.quantity*e.unitPrice)}),s.jsx("td",{className:"px-4 py-3 text-center",children:U.length>1&&s.jsx("button",{type:"button",onClick:()=>R(t),className:"text-gray-400 hover:text-red-500 transition",children:s.jsx(p.Z,{className:"w-4 h-4"})})})]},t))})]})}),s.jsx("div",{className:"flex justify-end",children:(0,s.jsxs)("div",{className:"w-full md:w-1/3 bg-gray-50 rounded-lg p-6 space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[s.jsx("span",{children:"Subtotal:"}),s.jsx("span",{children:q(z.subtotal)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[s.jsx("span",{children:"Total Tax:"}),s.jsx("span",{children:q(z.tax)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[s.jsx("span",{children:"Total Discount:"}),(0,s.jsxs)("span",{children:["-",q(z.discount)]})]}),(0,s.jsxs)("div",{className:"pt-3 border-t border-gray-200 flex justify-between items-center",children:[s.jsx("span",{className:"text-base font-bold text-gray-900",children:"Grand Total"}),s.jsx("span",{className:"text-xl font-bold text-primary-700",children:q(z.total)})]})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-8 pt-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Terms"}),s.jsx("textarea",{value:_.paymentTerms,onChange:e=>I({..._,paymentTerms:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:3})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Terms"}),s.jsx("textarea",{value:_.deliveryTerms,onChange:e=>I({..._,deliveryTerms:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:3})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),s.jsx("textarea",{value:_.notes,onChange:e=>I({..._,notes:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",rows:2})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 px-8 py-5 flex justify-end items-center space-x-4 border-t border-gray-100",children:[s.jsx("button",{type:"button",onClick:()=>j.back(),className:"px-5 py-2.5 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition",children:"Cancel"}),(0,s.jsxs)("button",{type:"submit",disabled:P,className:"px-5 py-2.5 bg-primary-600 text-white rounded-lg shadow-sm text-sm font-medium hover:bg-primary-700 disabled:opacity-50 flex items-center transition",children:[P&&s.jsx(d.T,{size:"sm",className:"mr-2"}),s.jsx(y.Z,{className:"w-4 h-4 mr-2"}),P?"Saving...":"Save Changes"]})]})]})]})}},55729:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let s=(0,r(86843).createProxy)(String.raw`/Users/arun/Documents/applizor-softech-erp/frontend/app/(main)/quotations/[id]/edit/page.tsx`),{__esModule:a,$$typeof:i}=s,n=s.default}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[6291,1934,783,7316,2841,2528],()=>r(44982));module.exports=s})();